!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["react-upload"]=t():e["react-upload"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}({"./src/components/Upload.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=m(n("babel-runtime/regenerator")),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n("react"),l=m(u),s=m(n("antd/lib/upload"));n("antd/lib/upload/style");var f=m(n("antd/lib/icon"));n("antd/lib/icon/style");var c=m(n("antd/lib/message"));n("antd/lib/message/style");var d=m(n("antd/lib/modal"));n("antd/lib/modal/style");var p=n("react-beautiful-dnd");function m(e){return e&&e.__esModule?e:{default:e}}var g=function(e){function t(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));a.getData=function(){return a.state.formData},a.handleRemove=function(e){var t="";return e&&e.response?t=e.response.data:e&&e.name&&(t=e.name),a.getImages(t),!0},a.ArrayRemoveByValue=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t){e.splice(n,1);break}return e},a.mergeFileList=function(e){var t=[],n=function(e){var n=!1;return t.map(function(t){return t.uid===e.uid&&(n=!0),null}),n};return a.state.fileList.map(function(e){return n(e)||"done"===e.status&&t.push(e),null}),e.map(function(e){return n(e)||t.push(e),null}),t},a.beforeUpload=function(e,t){var o=a.state,i=a.props||{},u=i.maxSize,l=i.getSign,s=i.extraParam,f=i.totalNum,d={"image/jpg":"jpg","image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/bmp":"bmp","image/webp":"webp"};return new Promise(function(i,p){if(o.fileList.length+t.length>f)return c.default.warn("最多上传"+f+"张图片 还能上传"+(f-o.fileList.length)+"张"),p(),!1;if(!d[e.type])return c.default.error("只能上传图片文件，可以是jpg/png/gif/bmp/webp格式!"),p(),!1;if(e.size/1024>(u||2048))return c.default.error("图片大小不能超过"+(u||2048)+"kb!"),p(),!1;var m=URL.createObjectURL(e),g=document.createElement("img");g.onload=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(a,o){try{var i=t[a](o),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}(r.default.mark(function t(){var o;return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l(d[e.type],g.width,g.height,s);case 2:if(o=t.sent){t.next=6;break}return p(),t.abrupt("return",!1);case 6:o.fileName=e.name,a.setState({formData:o},i);case 8:case"end":return t.stop()}},t,n)})),g.src=m})},a.handlePreview=function(e){var t=a.getPreNextInfo(e.name),n=t.currentIndex,r=t.needPre,o=t.needNext;a.setState({preview:!0,previewImage:e.url||e.thumbUrl,currentIndex:n,needPre:r,needNext:o})},a.handlePreviewClose=function(){a.setState({preview:!1})},a.showNextImage=function(e){var t=a.state.fileList[e+1],n=a.getPreNextInfo(t.name),r=n.currentIndex,o=n.needPre,i=n.needNext;a.setState({previewImage:t.url||t.thumbUrl,currentIndex:r,needPre:o,needNext:i})};var o=e.imageShowServiceHost,i=e.value,u=i?i.split(";"):[],l=[],s=[];return u&&u.length&&u.map(function(e,t){return l.push({uid:t,name:e,status:"done",thumbUrl:o+"/"+e,url:o+"/"+e}),s.push(e),null}),a.state={fileList:l,loading:!1,formData:{},preview:!1,previewImage:null,needPre:!0,needNext:!0,currentIndex:0},a.onDragEnd=a.onDragEnd.bind(a),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Component),a(t,[{key:"componentDidMount",value:function(){var e=this;document.removeEventListener("keyup",function(){}),document.addEventListener("keyup",function(t){var n=e.state,r=n.currentIndex,a=n.previewImage,o=n.fileList,i=t.key,u=t.code;"ArrowLeft"===i&&"ArrowLeft"===u&&a&&r>0&&e.showPreImage(r),"ArrowRight"===i&&"ArrowRight"===u&&a&&r<o.length-1&&e.showNextImage(r)})}},{key:"onDragEnd",value:function(e){var t=this,n=this.state.fileList;if(e.destination){var r=function(e,t,n){var r=Array.from(e),a=r.splice(t,1),o=i(a,1)[0];return r.splice(n,0,o),r}(n,e.source.index,e.destination.index);this.setState({fileList:r},function(){t.getImages()})}}},{key:"getImages",value:function(e){var t=this.props.onChange,n=[];this.state.fileList.map(function(e){return e.name&&n.push(e.name),null}),e&&(n=this.ArrayRemoveByValue(n,e)),t(n.join(";"))}},{key:"getPreNextInfo",value:function(e){var t=this.state.fileList,n=0,r=!0,a=!0;return t.map(function(t,r){return t.name===e&&(n=r),null}),0===n&&(r=!1),n===t.length-1&&(a=!1),{currentIndex:n,needPre:r,needNext:a}}},{key:"showPreImage",value:function(e){var t=this.state.fileList[e-1],n=this.getPreNextInfo(t.name),r=n.currentIndex,a=n.needPre,o=n.needNext;this.setState({previewImage:t.url||t.thumbUrl,currentIndex:r,needPre:a,needNext:o})}},{key:"uploadButton",value:function(){var e=this.state.loading;return l.default.createElement("div",{className:"d-ib"},l.default.createElement(f.default,{style:{fontSize:28},type:e?"loading":"plus"}),l.default.createElement("div",{className:"ant-upload-text"},"上传图片"))}},{key:"handleChange",value:function(e){var t=this,n=this.props.type,r=e.file,a=e.fileList;if(this.setState({fileList:this.mergeFileList(a)}),"uploading"!==r.status){if("done"===r.status){var o=!0;if("oss"===n){var i=r.response.data;a.map(function(e,t){return e.name===r.name&&(a[t].name=i.key),"done"!==e.status&&(o=!1),null})}if("qiniu"===n){var u=r.response;a.map(function(e,t){return e.name===r.name&&(a[t].name=u.key),"done"!==e.status&&(o=!1),null})}this.setState({loading:!1,fileList:this.mergeFileList(a)},function(){o&&t.getImages()})}}else this.setState({loading:!0})}},{key:"render",value:function(){var e=this.state,t=e.previewImage,n=e.fileList,r=e.currentIndex,a=e.needPre,i=e.needNext,u=e.preview,c=this.props,m=c.supportSort,g=c.totalNum,h={action:c.imageUploadServerHost,data:this.getData,beforeUpload:this.beforeUpload,onChange:this.handleChange,onRemove:this.handleRemove,fileList:n,listType:"picture-card",onPreview:this.handlePreview,multiple:g>1,className:"d-ib"},b={visible:u,title:"图片预览"+n.length+"/"+(r+1),footer:null,onCancel:this.handlePreviewClose},v={fontSize:30};return[l.default.createElement(s.default,o({key:"uploader"},h),n.length>=g?null:this.uploadButton()),l.default.createElement(d.default,o({key:"modal"},b),l.default.createElement("div",{style:{marginTop:-20,padding:"10px 0"}},a?l.default.createElement(f.default,{style:o({float:"left",color:"#40a9ff"},v),onClick:this.showPreImage.bind(this,r),type:"arrow-left"}):l.default.createElement(f.default,{style:o({float:"left",color:"#CDCDCD",cursor:"default"},v),type:"arrow-left"}),i?l.default.createElement(f.default,{style:o({float:"right",color:"#40a9ff"},v),onClick:this.showNextImage.bind(this,r),type:"arrow-right"}):l.default.createElement(f.default,{style:o({float:"right",color:"#CDCDCD",cursor:"default"},v),type:"arrow-right"})),l.default.createElement("img",{width:"100%",src:t,alt:""})),m&&n.length>1?l.default.createElement(p.DragDropContext,{key:"DragDropContext",onDragEnd:this.onDragEnd},l.default.createElement(p.Droppable,{droppableId:"droppable",direction:"horizontal"},function(e,t){return l.default.createElement("div",o({ref:e.innerRef,style:function(e){return{background:e?"lightblue":"lightgrey",display:"flex",padding:8,overflow:"auto"}}(t.isDraggingOver)},e.droppableProps),n.map(function(e,t){return l.default.createElement(p.Draggable,{key:e.uid,draggableId:e.uid,index:t},function(t,n){return l.default.createElement("div",o({ref:t.innerRef},t.draggableProps,t.dragHandleProps,{style:function(e,t){return o({userSelect:"none",padding:4,margin:"0 8px 0 0",background:e?"lightgreen":"grey"},t)}(n.isDragging,t.draggableProps.style)}),l.default.createElement("img",{src:e.thumbUrl,width:50,height:50,alt:""}))})}),e.placeholder)})):""]}}]),t}();g.defaultProps={totalNum:1,value:"",onChange:function(){},supportSort:!1,maxSize:2048,imageShowServiceHost:"",imageUploadServerHost:"",getSign:function(){}},t.default=g},"./src/index.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n("react"),o=l(a),i=l(n("./src/components/Upload.js")),u=l(n("prop-types"));function l(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.PureComponent),r(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.maxSize,r=e.totalNum,a=e.supportSort,u=e.imageUploadServerHost,l=e.imageShowServiceHost,s=e.extraParam,f=e.getSign,c=e.value,d=e.onChange;return o.default.createElement(i.default,{type:t,value:c,maxSize:n,totalNum:r,supportSort:a,getSign:f,extraParam:s,imageUploadServerHost:u,imageShowServiceHost:l,onChange:d})}}]),t}();s.defaultProps={type:"oss"},t.default=s,s.propTypes={type:u.default.string,maxSize:u.default.number,totalNum:u.default.number,supportSort:u.default.bool,imageUploadServerHost:u.default.string,imageShowServiceHost:u.default.string,extraParam:u.default.object,getSign:u.default.func.isRequired,onChange:u.default.func,value:u.default.string}},0:function(e,t,n){e.exports=n("./src/index.js")},"antd/lib/icon":function(e,t){e.exports=require("antd/lib/icon")},"antd/lib/icon/style":function(e,t){e.exports=require("antd/lib/icon/style")},"antd/lib/message":function(e,t){e.exports=require("antd/lib/message")},"antd/lib/message/style":function(e,t){e.exports=require("antd/lib/message/style")},"antd/lib/modal":function(e,t){e.exports=require("antd/lib/modal")},"antd/lib/modal/style":function(e,t){e.exports=require("antd/lib/modal/style")},"antd/lib/upload":function(e,t){e.exports=require("antd/lib/upload")},"antd/lib/upload/style":function(e,t){e.exports=require("antd/lib/upload/style")},"babel-runtime/regenerator":function(e,t){e.exports=require("babel-runtime/regenerator")},"prop-types":function(e,t){e.exports=require("prop-types")},react:function(e,t){e.exports=require("react")},"react-beautiful-dnd":function(e,t){e.exports=require("react-beautiful-dnd")}})});